# Insight: `backup_utils.py`

## 1. Module Type

`backup_utils.py` is a Python utility module. It provides functions specifically designed for constructing and executing `rsync`-based backup commands for project data.

## 2. Purpose

The primary purpose of this module is to facilitate automated and robust backups of project directories. It abstracts the complexities of `rsync` command construction and execution, allowing other parts of the application to easily trigger and manage backups.

## 3. Behavior and Functionality

- **`get_rsync_backup_command(projekt_summary_data, source_dir, dest_dir)`:**
  - Constructs a list of arguments for an `rsync` command.
  - It dynamically generates the log file path and the exclusion file path based on project data.
  - Ensures the `rsync_logs` directory exists within the destination.
  - Includes common `rsync` options like `archive` (`-a`), `verbose` (`-v`), `copy-links` (`--copy-links`), and excludes `.DS_Store` files.
  - Crucially, it incorporates an `--exclude-from` option, pointing to a project-specific exclusion list file.
- **`run_rsync_backup(rsync_command)`:**
  - Executes the `rsync` command using `subprocess.run()`.
  - It uses `check=True` to raise a `CalledProcessError` if the `rsync` command returns a non-zero exit code, indicating an error.
  - Prints success or error messages to the console.
- **`get_rsync_backup_script_path(projekt_summary_data)`:**
  - Constructs and returns the expected absolute path where a generated backup shell script would reside, based on the project summary data.

## 4. Key Functions

- `get_rsync_backup_command(projekt_summary_data: dict, source_dir: str, dest_dir: str) -> list[str]`:
  - Purpose: Generates a list of arguments for an `rsync` backup command.
  - Arguments: `projekt_summary_data` (project details), `source_dir` (directory to backup), `dest_dir` (backup destination).
  - Returns: A list of strings representing the `rsync` command and its arguments.
- `run_rsync_backup(rsync_command: list[str]) -> None`:
  - Purpose: Executes a given `rsync` command.
  - Arguments: `rsync_command` (the list of arguments generated by `get_rsync_backup_command`).
  - Behavior: Runs the command, prints status, raises `CalledProcessError` on failure.
- `get_rsync_backup_script_path(projekt_summary_data: dict) -> str`:
  - Purpose: Determines the expected path of a project-specific backup script.
  - Arguments: `projekt_summary_data` (project details).
  - Returns: The absolute path string to the backup script.

## 5. Signals and Slots

This module is a pure utility module and does not interact with PySide6. Therefore, it does not define or use any signals or slots.

## 6. Dependencies and Relationships

- **Standard Python Libraries:** `subprocess`, `os`.
- **External `rsync` Utility:** This module is critically dependent on the `rsync` command-line utility being installed and available on the system. This implies it is primarily designed for Unix-like operating systems (Linux, macOS).
- **`projekt_summary_data`:** The functions heavily rely on the `projekt_summary_data` dictionary, which is typically assembled by the main application logic (`AppLogic`) and contains all necessary project details.
- **`create_projekt_backup_script.py` (Implicit):** While not a direct import, `create_projekt_backup_script.py` is responsible for *generating* the shell scripts that this `backup_utils.py` module might then *run* or *reference* (e.g., the `exclusion_list.txt` and the `.sh` script itself).
- **Relationship to Project Creation Workflow:** This module is a key component in the overall project creation and maintenance workflow. It provides the programmatic interface for performing the actual backup operations that might be triggered by generated scripts or directly by the application.

## 7. Other Useful Information

- **Robust Backup Solution:** By leveraging `rsync`, this module provides a powerful and flexible backup solution, capable of handling incremental backups, preserving permissions, and excluding specific files/directories.
- **Automation:** It enables the automation of backup tasks, which is crucial for data integrity and disaster recovery in production environments.
- **Customization via Exclusion List:** The use of an `--exclude-from` file allows for fine-grained control over what data is included or excluded from backups, making the solution highly customizable for different project needs.
- **Error Reporting:** The `subprocess.CalledProcessError` handling provides clear feedback if the `rsync` command fails, which is essential for troubleshooting backup issues.